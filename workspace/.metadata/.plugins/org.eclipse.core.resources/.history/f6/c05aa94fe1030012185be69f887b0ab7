package pcremote.activities;

import java.io.OutputStream;
import java.util.concurrent.ArrayBlockingQueue;

import pcremote.custom.KeyboardController;
import pcremote.custom.KeyboardController.Keys;
import pcremote.storage.ServersStorage;
import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

public class MediaActivity extends Activity {

	private Button bplay;
	private OutputStream out;
	private ArrayBlockingQueue <Keys> entered = new ArrayBlockingQueue<Keys>(20);
	private Thread sendingThread;
	private Handler handle = new Handler();
	
	@Override
	public void onCreate(Bundle bund)
	{
		super.onCreate(bund);
		this.setContentView(R.layout.media_activity);
		bplay = (Button)findViewById(R.id.playButton);
		try
		{
			out = ServersStorage.getSocket().getOutputStream();
		}
		catch(Exception e)
		{
			Toast.makeText(this, getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
		}
	}
	
	@Override
	public void onStart()
	{
		super.onStart();
		sendingThread = new Thread(new Runnable(){
			public void run() {
				Keys k;
				while (!Thread.interrupted())
				{
					try
					{
						k = entered.take();
						if (k.state == Keys.State.CLICK)
							out.write(new byte[]{6,3,k.getCode()});
						else if (k.state == Keys.State.DOWN)
							out.write(new byte[]{6,1,k.getCode()});
						else
							out.write(new byte[]{6,2,k.getCode()});
					}
					catch(Exception e)
					{
						handle.post(new Runnable(){

							public void run() {
								Toast.makeText(MediaActivity.this, MediaActivity.this.getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
							}});
						
						entered.clear();
					}
				}
			}
		});
	}
	
	public void prevClicked(View v)
	{
		
	}
	public void nextClicked(View v)
	{
		
	}
	public void playClicked(View v)
	{
		
	}
	public void minusClicked(View v)
	{
		try
		{
			out.write(new byte[]{6,3,KeyboardController.Keys.VOLDOWN.getCode()});
		}
		catch(Exception e)
		{
			Toast.makeText(this, getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
		}
	}
	public void plusClicked(View v)
	{
		try
		{
			out.write(new byte[]{6,3,KeyboardController.Keys.VOLUP.getCode()});
		}
		catch(Exception e)
		{
			Toast.makeText(this, getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
		}
	}
	
	public void goToKeyboard(View v)
	{
		startActivity(new Intent(this, KeyboardActivity.class));
	}
	public void goToMousepad(View v)
	{
		startActivity(new Intent(this, MouseActivity.class));
	}
}
