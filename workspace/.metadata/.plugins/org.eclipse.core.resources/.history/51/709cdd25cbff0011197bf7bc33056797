package pcremote.custom;

import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

import pcremote.activities.R;
import pcremote.storage.CursorMovementData;
import pcremote.storage.ServersStorage;
import android.widget.Toast;

public class SendingThread extends Thread{

	private Handle handle;
	
	
	public void run() {
		CursorMovementData cmd;
		DatagramSocket clientSocket;
		InetAddress IPAddress = null;
		try
		{
			IPAddress = InetAddress.getByName(ServersStorage.getSelectedServer().Address());
		}
		catch(Exception e)
		{
			handle.post(new Runnable(){

				public void run() {
					Toast.makeText(MousePad.this.getContext(), MousePad.this.getContext().getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
				}});
			return;
		}
		while (!Thread.interrupted())
		{
			try
			{
			clientSocket = new DatagramSocket();
			cmd = movements.take();
		    DatagramPacket sendPacket = new DatagramPacket(new byte[] {1, cmd.x,cmd.y}, 3, IPAddress, 1234);
		    clientSocket.send(sendPacket);
		    clientSocket.close();
			}
			catch(Exception e)
			{
				handle.post(new Runnable(){

					public void run() {
						Toast.makeText(MousePad.this.getContext(), MousePad.this.getContext().getString(R.string.connectionLost), Toast.LENGTH_SHORT).show();
					}});
				
				movements.clear();
			}
		}
		
	}
}
